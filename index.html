<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Noomuri Nexus</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #00ffcc;
      margin-bottom: 10px;
    }
    #results {
      margin-top: 20px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tabs button {
      background: #111;
      color: #fff;
      border: 1px solid #333;
      padding: 8px 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .tabs button:hover {
      background: #222;
    }

    /* Spinner overlay with animated gradient */
    #spinner {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, #001f1f, #000);
      background-size: 400% 400%;
      animation: gradientShift 6s ease infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    }
    #spinner.active {
      opacity: 1;
      visibility: visible;
    }

    .loader {
      border: 6px solid #333;
      border-top: 6px solid #00ffcc;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite, glowPulse 2s ease-in-out infinite;
      box-shadow: 0 0 15px #00ffcc;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 5px #00ffcc; }
      50% { box-shadow: 0 0 25px #00ffcc; }
      100% { box-shadow: 0 0 5px #00ffcc; }
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Layer badge */
    #layerBadge {
      position: fixed;
      bottom: 10px; right: 10px;
      padding: 6px 12px;
      font-weight: bold;
      border-radius: 6px;
      font-family: system-ui, sans-serif;
      z-index: 1000;
      animation: badgePulse 2s ease-in-out infinite;
    }
    @keyframes badgePulse {
      0% { box-shadow: 0 0 5px currentColor; }
      50% { box-shadow: 0 0 20px currentColor; }
      100% { box-shadow: 0 0 5px currentColor; }
    }
  </style>
</head>
<body>
  <h1>Noomuri Nexus</h1>
  <input id="searchBox" type="text" placeholder="Search..." style="width:60%; padding:8px;" />
  <button onclick="runSearch()">Search</button>

  <div class="tabs">
    <button onclick="switchTab('all')">All</button>
    <button onclick="switchTab('images')">Images</button>
    <button onclick="switchTab('videos')">Videos</button>
    <button onclick="switchTab('news')">News</button>
    <button onclick="switchTab('more')">More</button>
  </div>

  <div id="results">Enter a query above.</div>

  <!-- Spinner overlay -->
  <div id="spinner"><div class="loader"></div></div>

  <!-- Layer badge -->
  <div id="layerBadge">Detectingâ€¦</div>

  <script>
    const WORKER_URL = "https://noomuri-nexus.susbobby1.workers.dev";
    const FALLBACK_URL = "https://susbobby1.github.io/noomuri-nexus/search.html";
    let currentTab = "all";

    function switchTab(tab) {
      currentTab = tab;
      const query = document.getElementById("searchBox").value;
      runSearch(query, tab);
    }

    async function runSearch(query, tab = currentTab) {
      if (!query) {
        document.getElementById("results").innerHTML = "<p>Please enter a search query.</p>";
        return;
      }

      showSpinner(true);
      document.getElementById("results").style.opacity = 0;

      try {
        const endpoint = `${WORKER_URL}/search?q=${encodeURIComponent(query)}&tab=${tab}&mode=json`;
        const res = await fetch(endpoint);

        if (!res.ok) throw new Error(`Worker error: ${res.status}`);

        const data = await res.json();
        document.getElementById("results").innerHTML = data.html;

        setTimeout(() => {
          document.getElementById("results").style.opacity = 1;
        }, 100);
      } catch (err) {
        console.warn("Worker failed, falling back:", err.message);
        document.getElementById("results").innerHTML = `
          <iframe src="${FALLBACK_URL}?q=${encodeURIComponent(query)}&tab=${tab}" 
                  style="width:100%; height:80vh; border:none;"></iframe>
        `;
        setTimeout(() => {
          document.getElementById("results").style.opacity = 1;
        }, 100);
      } finally {
        showSpinner(false);
      }
    }

    function showSpinner(active) {
      const spinner = document.getElementById("spinner");
      spinner.classList.toggle("active", active);
    }

    async function detectLayer() {
      try {
        const res = await fetch(`${WORKER_URL}/version.json`);
        const data = await res.json();
        setLayerBadge(data.layer);
      } catch {
        setLayerBadge("fallback");
      }
    }

    function setLayerBadge(layer) {
      const badge = document.getElementById("layerBadge");
      if (layer === "worker") {
        badge.textContent = "Live";
        badge.style.background = "#00ffcc";
        badge.style.color = "#000";
      } else {
        badge.textContent = "Fallback";
        badge.style.background = "#ff0066";
        badge.style.color = "#fff";
      }
    }

    detectLayer();
  </script>
</body>
</html>
